
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Provisioning a Document Set</title>
    
    <meta name="author" content="Peter Gerritsen">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">Peter Gerritsen’s blog</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/categories.html">Categories</a></li>
      	
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/pages.html">Pages</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>Provisioning a Document Set </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>06 November 2009</span>
    </div>
    <div class="content">
      <p>In this post I’ll show you how to create a project in Visual Studio 2010 with the new SharePoint project and item templates to provision a Document Set from a feature.</p>

<p>DISCLAIMER: The examples are build on and tested against a Beta 1 build of SharePoint 2010 and a Beta 1 build of Visual Studio 2010, so there is no guarantee this will work on later versions or even on the Beta 1 build you&#8217;re running.</p>

<p>A Document Set is basically a content type just like all the others you can find in SharePoint, it derives from the Folder content type. So the steps you need to take to provision a Document Set content type are not that different as well.</p>

<p>We’ll start out by creating an empty SharePoint project in Visual Studio 2010 and work from there.</p>

<p>First we’ll add a Content Type item to the project. In the elements.xml file we place the following content:</p>

<p><code>xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;elements xmlns=&quot;http://schemas.microsoft.com/sharepoint/&quot;&gt;
&lt;contentType ID=&quot;0x0120D520002228EBDE71841343B23171CE351F7D39&quot; Name=&quot;Test Doc Set&quot; Group=&quot;Document Set Content Types&quot; Version=&quot;2&quot; ProgId=&quot;SharePoint.DocumentSet&quot;&gt;
&lt;folder TargetName=&quot;_cts/Test Doc Set&quot; /&gt;
&lt;fieldRefs&gt;
&lt;fieldRef ID=&quot;{038d1503-4629-40f6-adaf-b47d1ab2d4fe}&quot; Name=&quot;Company&quot; /&gt;
&lt;/fieldRefs&gt;
&lt;xmlDocuments&gt;
&lt;xmlDocument NamespaceURI=&quot;http://schemas.microsoft.com/sharepoint/events&quot;&gt;
&lt;spe:Receivers xmlns:spe=&quot;http://schemas.microsoft.com/sharepoint/events&quot;&gt;
&lt;receiver&gt;
&lt;name&gt;DocumentSet ItemUpdated&lt;/name&gt;
&lt;synchronization&gt;Synchronous&lt;/synchronization&gt;
&lt;type&gt;10002&lt;/type&gt;
&lt;sequenceNumber&gt;100&lt;/sequenceNumber&gt;
&lt;assembly&gt;Microsoft.Office.DocumentManagement, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&lt;/assembly&gt;
&lt;class&gt;Microsoft.Office.DocumentManagement.DocumentSets.DocumentSetEventReceiver&lt;/class&gt;
&lt;data /&gt;
&lt;filter /&gt;
&lt;/receiver&gt;
&lt;receiver&gt;
&lt;name&gt;DocumentSet ItemAdded&lt;/name&gt;
&lt;synchronization&gt;Synchronous&lt;/synchronization&gt;
&lt;type&gt;10001&lt;/type&gt;
&lt;sequenceNumber&gt;100&lt;/sequenceNumber&gt;
&lt;assembly&gt;Microsoft.Office.DocumentManagement, Version=14.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c&lt;/assembly&gt;
&lt;class&gt;Microsoft.Office.DocumentManagement.DocumentSets.DocumentSetItemsEventReceiver&lt;/class&gt;
&lt;data /&gt;
&lt;filter /&gt;
&lt;/receiver&gt;
&lt;/spe:Receivers&gt;
&lt;/xmlDocument&gt;
&lt;xmlDocument NamespaceURI=&quot;http://schemas.microsoft.com/office/documentsets/allowedcontenttypes&quot;&gt;
&lt;act:AllowedContentTypes xmlns:act=&quot;http://schemas.microsoft.com/office/documentsets/allowedcontenttypes&quot; LastModified=&quot;11/4/2009 3:30:17 PM&quot;&gt;
&lt;allowedContentType id=&quot;0x0101&quot; /&gt;
&lt;/act:AllowedContentTypes&gt;
&lt;/xmlDocument&gt;
&lt;xmlDocument NamespaceURI=&quot;http://schemas.microsoft.com/office/documentsets/sharedfields&quot;&gt;
&lt;sf:SharedFields xmlns:sf=&quot;http://schemas.microsoft.com/office/documentsets/sharedfields&quot; LastModified=&quot;11/4/2009 3:31:50 PM&quot;&gt;
&lt;sharedField id=&quot;cbb92da4-fd46-4c7d-af6c-3128c2a5576e&quot; /&gt;
&lt;sharedField id=&quot;038d1503-4629-40f6-adaf-b47d1ab2d4fe&quot; /&gt;
&lt;/sf:SharedFields&gt;
&lt;/xmlDocument&gt;
&lt;xmlDocument NamespaceURI=&quot;http://schemas.microsoft.com/office/documentsets/welcomepagefields&quot;&gt;
&lt;wpf:AllowedContentTypes xmlns:wpf=&quot;http://schemas.microsoft.com/office/documentsets/welcomepagefields&quot; LastModified=&quot;11/4/2009 3:31:50 PM&quot;&gt;
&lt;welcomePageField id=&quot;038d1503-4629-40f6-adaf-b47d1ab2d4fe&quot; /&gt;
&lt;/wpf:AllowedContentTypes&gt;
&lt;/xmlDocument&gt;
&lt;xmlDocument NamespaceURI=&quot;http://schemas.microsoft.com/office/documentsets/defaultdocuments&quot;&gt;
&lt;dd:DefaultDocuments xmlns:dd=&quot;http://schemas.microsoft.com/office/documentsets/defaultdocuments&quot; LastModified=&quot;11/5/2009 8:39:24 AM&quot; AddSetName=&quot;True&quot;&gt;
&lt;defaultDocument name=&quot;Enterprise Content Management.docx&quot; idContentType=&quot;0x0101&quot; /&gt;
&lt;defaultDocument name=&quot;Extending Search.docx&quot; idContentType=&quot;0x0101&quot; /&gt;
&lt;/dd:DefaultDocuments&gt;
&lt;/xmlDocument&gt;
&lt;xmlDocument NamespaceURI=&quot;http://schemas.microsoft.com/sharepoint/v3/contenttype/forms&quot;&gt;
&lt;formTemplates xmlns=&quot;http://schemas.microsoft.com/sharepoint/v3/contenttype/forms&quot;&gt;
&lt;display&gt;DocSetDisplayForm&lt;/display&gt;
&lt;edit&gt;ListForm&lt;/edit&gt;
&lt;new&gt;DocSetDisplayForm&lt;/new&gt;
&lt;/formTemplates&gt;
&lt;/xmlDocument&gt;
&lt;xmlDocument NamespaceURI=&quot;http://schemas.microsoft.com/sharepoint/v3/contenttype/forms/url&quot;&gt;
&lt;formUrls xmlns=&quot;http://schemas.microsoft.com/sharepoint/v3/contenttype/forms/url&quot;&gt;
&lt;new&gt;_layouts/NewDocSet.aspx&lt;/new&gt;
&lt;/formUrls&gt;
&lt;/xmlDocument&gt;
&lt;/xmlDocuments&gt;
&lt;/contentType&gt;
&lt;/elements&gt;
</code></p>

<p>As you can see, the basics are the same as for any content type. The main difference is in all the XmlDocument elements in there:</p>

<p>* Some event handlers are hooked up to make sure the metadata gets pushed down into the child documents (plus some other stuff) * The content types that users are allowed to add to the set are specified * We specify which fields are shared between the documents the set contains * The fields that are shown on the welcome page are defined as well * We then specify if there’s default content to add when a new Document Set is created</p>

<p>After we’ve created the basic plumbing for the Document Set content type, we’ll need to make sure that the files that are required are created in the right place as well. In order to accomplish this we’ll add a SharePoint Module item to the solution. This module will create the welcome page and default content in the right location in the site collection. The element.xml file will contain the following content:</p>

<p><code>xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;elements xmlns=&quot;http://schemas.microsoft.com/sharepoint/&quot;&gt;
&lt;module Name=&quot;_ctsTest Doc Set_&quot; HyperlinkBaseUrl=&quot;http://moss.contoso.com/sites/docsettest&quot; Path=&quot;WelcomePages\Files\_cts\Test Doc Set&quot; Url=&quot;_cts/Test Doc Set&quot;&gt;
&lt;file Url=&quot;docsethomepage.aspx&quot; Path=&quot;docsethomepage.aspx&quot;&gt;
&lt;allUsersWebPart WebPartOrder=&quot;0&quot; WebPartZoneID=&quot;WebPartZone_TopLeft&quot; ID=&quot;g_ae6da3d4_9233_45d6_b9fd_6300815e16c6&quot;&gt;
&lt;![CDATA[Content omitted]]&gt;
&lt;/allUsersWebPart&gt;
&lt;allUsersWebPart WebPartOrder=&quot;0&quot; WebPartZoneID=&quot;WebPartZone_CenterMain&quot; ID=&quot;g_d8062545_cc87_4e82_9c55_cae80486ffea&quot;&gt;
&lt;![CDATA[Content omitted]]&gt;
&lt;/allUsersWebPart&gt;
&lt;allUsersWebPart WebPartOrder=&quot;0&quot; WebPartZoneID=&quot;WebPartZone_Top&quot; ID=&quot;g_651be1ba_c8bb_4d29_87b0_87c769cd5179&quot;&gt;
&lt;![CDATA[Content omitted]]&gt;
&lt;/allUsersWebPart&gt;
&lt;/file&gt;
&lt;file Path=&quot;Enterprise Content Management.docx&quot; Url=&quot;Enterprise Content Management.docx&quot; /&gt;
&lt;file Path=&quot;Extending Search.docx&quot; Url=&quot;Extending Search.docx&quot; /&gt;
&lt;/module&gt;
&lt;/elements&gt;
</code></p>

<p>We see that the page layout for the document set homepage is created in the _cts folder for the content type. The web parts that are placed on the page are configured here as well, so any modifications and additions will be used on the welcome page of all document sets based in this content type. Also the two documents for the default content are placed in the corresponding _cts folder in the site collection.</p>

<p>The final Visual Studio solution will look like this:</p>

<p><a href='http://blog.petergerritsen.nl/wp-content/uploads/snipping10.png'><img alt='image' src='http://blog.petergerritsen.nl/wp-content/uploads/snipping11.png' /></a></p>

<p>After deploying the solution and activating the feature, which is very easy to do with the new SharePoint stuff in Visual Studio (just press ctrl + f5), we can see that the _cts folder will be created in the site collection:</p>

<p><a href='http://blog.petergerritsen.nl/wp-content/uploads/snipping12.png'><img alt='image' src='http://blog.petergerritsen.nl/wp-content/uploads/snipping13.png' /></a></p>

<p>After we add the content type to a document library and create a new item based on the content type we’ll be presented with the following:</p>

<p><a href='http://blog.petergerritsen.nl/wp-content/uploads/snipping14.png'><img alt='image' src='http://blog.petergerritsen.nl/wp-content/uploads/snipping15.png' /></a></p>

<p>You can download the sample solution here: <a href='http://blog.petergerritsen.nl/wp-content/uploads/DocSetProvisioning.zip'>DocSetProvisioning.zip (62,88 KB)</a></p>

<p>DISCLAIMER: This hasn&#8217;t been properly tested, so there&#8217;s is no guarantee it will work. If it f@#@s up your farm, the most you can expect as support from me, is an email wishing you good luck with restoring it.</p>
    </div>

    

  
    <ul class="tag_box inline">
      <li><i class="icon-tags"></i></li>
      
      


  
     
    	<li><a href="/tags.html#Document Sets-ref">Document Sets <span>2</span></a></li>
     
    	<li><a href="/tags.html#SP2010-ref">SP2010 <span>20</span></a></li>
    
  



    </ul>
    

    <hr>
    <div class="pagination">
      <ul>
      
        <li class="prev"><a href="/2009/11/06/coding-against-a-document-set" title="Coding against a Document Set">&larr; Previous</a></li>
      
        <li><a href="/archive.html">Archive</a></li>
      
        <li class="next"><a href="/2009/12/01/infopath-form-template-stays-in-e2809cinstallinge2809d-state" title="InfoPath Form Template stays in “installing” state">Next &rarr;</a></li>
      
      </ul>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'jekyllbootstrap'; // required: replace example with your forum shortname
    var disqus_identifier = '540 http://username.github.io/?p=540';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2013 Peter Gerritsen
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    
  </body>
</html>

